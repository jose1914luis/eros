var addImages=[];$(function(){$("#div_alerta").hide(),$("#public_div").hide(),$("#public_label").hide();var e=function(){return $("#editor").val().length<50?(alert("Debes ingresar una descripcion mas larga"),$("#editor").focus(),!1):!0};$("#publicar").on("submit",function(a){if(a.preventDefault(),e()){$("#numfiles").attr("value",addImages.length);for(var t=new FormData(this),i=0;i<addImages.length;i++)t.append("file_"+(i+1),addImages[i]);$("#public_div").show(),$("#public_label").show(),$.ajax({url:"./bd/publicar.php",type:"POST",data:t,contentType:!1,cache:!1,processData:!1,success:function(e){e>0?window.location.href="index.php?primera=1&idanuncio="+e:($("#div_alerta").attr("class","alert alert-danger"),$("#div_alerta").text(""),$("#div_alerta").html("<b>Ups hubo un Error!!.</b> Por favor vuelve a intentar."))},fail:function(e){$("#div_alerta").attr("class","alert alert-danger"),$("#div_alerta").text(""),$("#div_alerta").html("<b>Ups hubo un Error!!.</b> Por favor vuelve a intentar."),$("#public_div").hide(),$("#public_label").hide()}})}}),CKEDITOR.replace("editor",{toolbar:[{name:"basicstyles",items:["Bold","Italic"]},{name:"styles",items:["Styles","Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote"]},{name:"links",items:["Link","Unlik","Anchor"]},{name:"document",items:["-","NewPage","Preview","-","Templates"]},["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]]});for(var a=1;8>=a;a++)$("#image_"+a).attr("style","visibility: hidden"),$("#btn_close_"+a).hide(),$("#btn_mas_"+a).on("click",function(){var e=$(this).attr("id");$("#file_"+e[e.length-1]).click()}),$("#btn_close_"+a).on("click",function(){var e=$(this).attr("id");t(e[e.length-1])}),$("#file_"+a).change(function(){var e=$(this).attr("id");i(this,e[e.length-1])});var t=function(e){$("#image_"+e).attr("src",null),$("#image_"+e).attr("style","visibility: hidden"),$("#btn_mas_"+e).attr("class","btn_mas fa fa-camera-retro fa-3x"),$("#btn_mas_"+e).show(),$("#btn_close_"+e).hide(),addImages=[]};$("#dep").change(function(){$.get("./bd/getMun.php",{iddep:$("#dep").val()}).done(function(e){$('#mun option[value!="-1"]').remove(),$.each(e,function(e,a){$("#mun").append($("<option></option>").attr("value",a.idmun).text(a.nombre))})}).fail(function(){alert("Error de comunicación")})});var i=function(e,a){var t=e.files[0],i=t.type,n=["image/jpeg","image/png","image/jpg"];if(t.size>1e7)return alert("La foto debe ser de un tamaño menor a 10Mb. Intente con otra foto o reduzca su tamaño."),!1;if(i!=n[0]&&i!=n[1]&&i!=n[2])return alert('Seleccione un formato valido "image/jpeg", "image/png", "image/jpg"'),!1;var r=new FileReader;r.onload=function(e){$("#image_"+a).attr("style","visibility: visible"),$("#btn_close_"+a).show(),rederizarCanvas($("#image_"+a),e.target.result,550,550,100,100),$("#btn_mas_"+a).hide()},r.readAsDataURL(e.files[0])}});