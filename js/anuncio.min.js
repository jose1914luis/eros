var addImages=[];$(function(){$("#div_alerta").hide();var a=function(){return!($("#editor").val().length<50)||(alert("Debes ingresar una descripcion mas larga"),$("#editor").focus(),!1)};$("#publicar").on("submit",function(b){if(b.preventDefault(),a()){$("#numfiles").attr("value",addImages.length);for(var c=new FormData(this),d=0;d<addImages.length;d++)c.append("file_"+(d+1),addImages[d]);$.ajax({url:"./bd/publicar.php",type:"POST",data:c,contentType:!1,cache:!1,processData:!1,success:function(a){$("html, body").animate({scrollTop:0},900),$("#publicar").find("input, textarea").val(""),$("#div_alerta").show(),$("#anuncio").scrollTop(),e(),a>0?($("#div_alerta").attr("class","alert alert-success"),$("#div_alerta").text(""),$("#div_alerta").html('<b>Genial!! Tu anuncio fue creado satisfactoriamente</b>, se te envio un correo con un numero de registro y la informacion adicional para que puedas promover tu anuncio y obtener mejores resultados. <a href="index.php?idanuncio='+a+'">ver anuncio</a> ')):($("#div_alerta").attr("class","alert alert-danger"),$("#div_alerta").text(""),$("#div_alerta").html("<b>Ups hubo un Error!!.</b> Por favor vuelve a intentar."))},fail:function(a){alerta("Error: "+a+". Vuelve a intentar.")}})}}),$("#editor").cleditor({controls:"bold italic underline strikethrough subscript superscript | font size style | color highlight removeformat | bullets numbering | outdent indent | alignleft center alignright justify | undo redo | rule link unlink | cut copy paste pastetext"});var b=$("#editor").cleditor()[0],c=b.$frame[0].contentWindow.document;$(c).bind("keydown change",function(a){var c=b.$area.val();if(c.length>=32700&&8!=a.which)return console.log("Longer than MaxLength"),!1});for(var d=1;d<=8;d++)$("#image_"+d).attr("style","visibility: hidden"),$("#btn_close_"+d).hide(),$("#btn_mas_"+d).on("click",function(){var a=$(this).attr("id");$("#file_"+a[a.length-1]).click()}),$("#btn_close_"+d).on("click",function(){var a=$(this).attr("id");f(a[a.length-1])}),$("#file_"+d).change(function(){var a=$(this).attr("id");g(this,a[a.length-1])});var e=function(){for(var a=1;a<=8;a++)f(a)},f=function(a){$("#image_"+a).attr("src",null),$("#image_"+a).attr("style","visibility: hidden"),$("#btn_mas_"+a).attr("class","btn_mas fa fa-camera-retro fa-3x"),$("#btn_mas_"+a).show(),$("#btn_close_"+a).hide(),addImages=[]};$("#dep").change(function(){$.get("./bd/getMun.php",{iddep:$("#dep").val()}).done(function(a){$('#mun option[value!="-1"]').remove(),$.each(a,function(a,b){$("#mun").append($("<option></option>").attr("value",b.idmun).text(b.nombre))})}).fail(function(){alert("Error de comunicación")})});var g=function(a,b){var c=a.files[0],d=c.type,e=["image/jpeg","image/png","image/jpg"];if(c.size>1e7)return alert("La foto debe ser de un tamaño menor a 10Mb. Intente con otra foto o reduzca su tamaño."),!1;if(d!=e[0]&&d!=e[1]&&d!=e[2])return alert('Seleccione un formato valido "image/jpeg", "image/png", "image/jpg"'),!1;var f=new FileReader;f.onload=function(a){$("#image_"+b).attr("style","visibility: visible"),$("#btn_close_"+b).show(),rederizarCanvas($("#image_"+b),a.target.result,550,450,100,100),$("#btn_mas_"+b).hide()},f.readAsDataURL(a.files[0])}});