var addImages=[];$(function(){$("#div_alerta").hide(),$("#public_div").hide(),$("#public_label").hide();var e=function(){return 0==$("#mun").val()?($("#mun").focus(),alert("Selecciona una Ciudad"),!1):CKEDITOR.instances.editor.getData().length<30?(alert("Debes ingresar una descripcion mas larga"),$("#editor").focus(),!1):!0};$("#publicar").on("submit",function(t){if(t.preventDefault(),e()){$("#numfiles").attr("value",addImages.length);for(var a=new FormData(this),i=0;i<addImages.length;i++)a.append("file_"+(i+1),addImages[i]);a.append("texto",CKEDITOR.instances.editor.getData()),a.append("url","/"+$("#categoria option:selected").text()+"/"+$("#dep option:selected").text()+"/"),$("#public_div").show(),$("#public_label").show(),$.ajax({url:"/bd/publicar.php",type:"POST",data:a,contentType:!1,cache:!1,processData:!1,success:function(e){e>0?(window.location.href="/P_AN/"+e+"/"+$("#categoria option:selected").text()+"/"+$("#dep option:selected").text()+"/",$("#div_alerta").hide(),$("#public_div").hide()):($("#div_alerta").attr("class","alert alert-danger"),$("#div_alerta").text(""),$("#div_alerta").html("<b>Ups hubo un Error!!.</b> Por favor vuelve a intentar."))},fail:function(e){$("#div_alerta").attr("class","alert alert-danger"),$("#div_alerta").text(""),$("#div_alerta").html("<b>Ups hubo un Error!!.</b> Por favor vuelve a intentar."),$("#public_div").hide(),$("#public_label").hide()}})}}),CKEDITOR.replace("editor",{toolbar:[{name:"basicstyles",items:["Bold","Italic"]},{name:"styles",items:["Styles","Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote"]},{name:"links",items:["Link","Unlik","Anchor"]},{name:"document",items:["-","NewPage","Preview","-","Templates"]},["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]]});for(var t=1;8>=t;t++)$("#image_"+t).attr("style","visibility: hidden"),$("#btn_close_"+t).hide(),$("#btn_mas_"+t).on("click",function(){var e=$(this).attr("id");$("#file_"+e[e.length-1]).click()}),$("#btn_close_"+t).on("click",function(){var e=$(this).attr("id");a(e[e.length-1])}),$("#file_"+t).change(function(){var e=$(this).attr("id");i(this,e[e.length-1])});var a=function(e){$("#image_"+e).attr("src",null),$("#image_"+e).attr("style","visibility: hidden"),$("#btn_mas_"+e).attr("class","btn_mas fa fa-camera-retro fa-3x"),$("#btn_mas_"+e).show(),$("#btn_close_"+e).hide(),addImages=[]};$("#dep").change(function(){$.get("/bd/getMun.php",{iddep:$("#dep").val(),id:1}).done(function(e){$('#mun option[value!="-1"]').remove(),$("#mun").append($("<option></option>").attr("value",0).text("Selecciona")),$.each(e,function(e,t){$("#mun").append($("<option></option>").attr("value",t.idmun).text(t.m_nombre))})}).fail(function(){alert("Error de comunicación")})});var i=function(e,t){var a=e.files[0],i=a.type,n=["image/jpeg","image/png","image/jpg"];if(a.size>1e7)return alert("La foto debe ser de un tamaño menor a 10Mb. Intente con otra foto o reduzca su tamaño."),!1;if(i!=n[0]&&i!=n[1]&&i!=n[2])return alert('Seleccione un formato valido "image/jpeg", "image/png", "image/jpg"'),!1;var r=new FileReader;r.onload=function(e){$("#image_"+t).attr("style","visibility: visible"),$("#btn_close_"+t).show(),rederizarCanvas($("#image_"+t),e.target.result,550,550,100,100),$("#btn_mas_"+t).hide()},r.readAsDataURL(e.files[0])}});